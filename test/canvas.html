<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        var startTime = Date.now();
    </script>
    <meta charset="UTF-8">
    <style>
        body{
            margin: 0px;
        }
    </style>
    <title>Canvas</title>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        var canvas = document.getElementById('canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight-4;
        var ctx = canvas.getContext('2d');
        Recycling(canvas.height/2, {x:canvas.width/2, y: canvas.height/3});


        function Recycling (height, topPoint){
            //#####
            var num = 0;
            //#####

            var sqrt3 = Math.sqrt(3);
            var hDivSqrt3 = height/sqrt3;
            var sideLength = 2*hDivSqrt3;
            var pastLength = 0;


            var arrowHeight = height*0.8;
            var arrowWidth = arrowHeight*0.6;
            var arrowHeadHeight = arrowHeight*0.25;

            var bottomY = topPoint.y + height;

            var leftPoint = {
                x: topPoint.x - hDivSqrt3,
                y: bottomY
            };

            var rightPoint = {
                x: topPoint.x + hDivSqrt3,
                y: bottomY
            };

            //#######
            drawTriangle();
            drawArcs();

            function drawTriangle() {
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(topPoint.x, topPoint.y);
                ctx.lineTo(rightPoint.x, rightPoint.y);
                ctx.lineTo(leftPoint.x, leftPoint.y);
                ctx.lineTo(topPoint.x, topPoint.y);
                ctx.stroke();
            }

            function drawArcs() {
                var pastPart = 2.43*arrowHeadHeight/sideLength;

                var leftBottom = {
                    x: (topPoint.x - leftPoint.x)*pastPart + leftPoint.x,
                    y: leftPoint.y - (leftPoint.y - topPoint.y)*pastPart
                };
                var leftTop = {
                    x: topPoint.x - (topPoint.x - leftPoint.x)*pastPart,
                    y: (leftPoint.y - topPoint.y)*pastPart+topPoint.y
                };
                var rightTop = {
                    x: (rightPoint.x - topPoint.x)*pastPart+topPoint.x,
                    y: (rightPoint.y - topPoint.y)*pastPart+topPoint.y
                };
                var rightBottom = {
                    x: rightPoint.x - (rightPoint.x - topPoint.x)*pastPart,
                    y: rightPoint.y - (rightPoint.y - topPoint.y)*pastPart
                };
                var bottomRight = {
                    x:rightPoint.x - (rightPoint.x - leftPoint.x)*pastPart,
                    y:bottomY
                };
                var bottomLeft = {
                    x:leftPoint.x + (rightPoint.x - leftPoint.x)*pastPart,
                    y:bottomY
                };

                var top = {
                    x: average(leftTop.x, rightTop.x),
                    y: average(leftTop.y, rightTop.y)
                };

                var left = {
                    x: average(bottomLeft.x, leftBottom.x),
                    y: average(bottomLeft.y, leftBottom.y)
                };

                var right = {
                    x: average(bottomRight.x, rightBottom.x),
                    y: average(bottomRight.y, rightBottom.y)
                };

                var touchPoint = {
                    x: Math.round((3*topPoint.x+top.x+sqrt3*(topPoint.y-top.y))/4)
                };

                Object.defineProperty(touchPoint, 'y', {
                    get: function () {
                        return Math.round((this.x-top.x)/sqrt3 + top.y);
                    }
                });

                var radius = Math.sqrt(pow2(top.x-touchPoint.x)+pow2(top.y-touchPoint.y));

                ctx.beginPath();
                arc(top.x, top.y);
                arc(right.x, right.y);
                arc(left.x, left.y);
                //arc(touchPoint.x, touchPoint.y);
                //####

                //####
                ctx.stroke();
                return;

                function arc (x, y) {
                    ctx.moveTo(x+radius, y);
                    ctx.arc(x, y, radius, 0, 2*Math.PI, true);
                    return;
                }
                function average(a, b) {
                    return Math.round((a+b)/2);
                }
                function pow2(val) {
                    return Math.pow(val, 2);
                }
            }

            //#######

            function drawArrow() {
                return new Promise(function (resolve) {
                    var topPoints = arrowTop();
                    console.log(++num);
                    Arrow(topPoints.pointOnLeft);
                    Arrow(topPoints.pointOnRight);
                    Arrow(topPoints.pointOnBottom);

                    resolve();
                });
            }

            function arrowTop() {
                var pastPart = (pastLength<sideLength)?(pastLength++/sideLength):(pastLength=0);
                var pointOnLeft = {
                    x: Math.round((topPoint.x-leftPoint.x)*pastPart + leftPoint.x),
                    y: Math.round(leftPoint.y - (leftPoint.y - topPoint.y)*pastPart)
                };
                var pointOnRight = {
                    x: Math.round((rightPoint.x-topPoint.x)*pastPart+topPoint.x),
                    y: Math.round((rightPoint.y-topPoint.y)*pastPart+topPoint.y)
                };
                var pointOnBottom={
                    x:Math.round(rightPoint.x-(rightPoint.x-leftPoint.x)*pastPart),
                    y:Math.round(bottomY)
                };
                return {
                    pointOnLeft: pointOnLeft,
                    pointOnRight: pointOnRight,
                    pointOnBottom: pointOnBottom
                };
            }

            function Arrow(start) {

                /*
                ** A        A
                **          *
                **        *****
                ** B  B1********* B4
                **      B2*****B3
                **        *****
                **        *****
                **        *****
                **        *****
                ** C      *****
                **       C1    C2
                */

                function arrowHeadBottom() {
                    //Возвращает координаты 4-х точек основания шаки стрелки

                }

                function arrowBottom() {
                    //Возвращает координаты 2-х точек основания стрелки
                }

            }
        }



        /*var img = new Image();
        img.addEventListener('load', function () {
            drawInAnotherColor(getImageData(img));
        }, false);
        img.src = '../logo.png';

        function drawInAnotherColor(imageData) {
            getAnotherColor(imageData)
                .then(function (imageData) {
                    ctx.clearRect(100, 100, img.naturalWidth, img.naturalHeight);
                    ctx.putImageData(imageData, 100, 100);
                    setTimeout(function () {
                        drawInAnotherColor(imageData);
                    }, 1);
                });
            return;
        }

        var Colors = function () {
            var colors = [
                [102, 105, 255],
                [155, 187, 255],
                [255, 255, 255],
                [255, 250, 181],
                [255, 238, 45],
                [232, 125, 18],
                [255, 32, 31],
                [0, 0, 0]
            ];
            
            function SmoothColorTransition(curRgb, nextRgb) {
                var rSteps = nextRgb[0]-curRgb[0];
                var gSteps = nextRgb[1]-curRgb[1];
                var bSteps = nextRgb[2]-curRgb[2];

                var rStepsAbs = Math.abs(rSteps);
                var gStepsAbs = Math.abs(gSteps);
                var bStepsAbs = Math.abs(bSteps);

                var moreSteps = Math.max(rStepsAbs, gStepsAbs, bStepsAbs);

                if (moreSteps===rStepsAbs){
                    var rCurrent = curRgb[0];
                    var rStep = rSteps/rStepsAbs;
                    Object.defineProperties(this, {
                        passedPercent:{
                            get: function () {
                                return (rCurrent-curRgb[0])/rSteps;
                            }
                        },
                        red:{
                            get: function () {
                                var result = rCurrent;
                                rCurrent+=rStep;
                                return result;
                            }
                        },
                        green: {
                            get: function () {
                                return Math.round(this.passedPercent*gSteps)+curRgb[1];
                            }
                        },
                        blue: {
                            get: function () {
                                return Math.round(this.passedPercent*bSteps)+curRgb[2];
                            }
                        }

                    });
                } else if(moreSteps === gStepsAbs){
                    var gCurrent = curRgb[1];
                    var gStep = gSteps/gStepsAbs;
                    Object.defineProperties(this, {
                        passedPercent:{
                            get: function () {
                                return (gCurrent-curRgb[1])/gSteps;
                            }
                        },
                        red:{
                            get: function () {
                                return Math.round(this.passedPercent*rSteps)+curRgb[0];
                            }
                        },
                        green:{
                            get: function () {
                                var result = gCurrent;
                                gCurrent+=gStep;
                                return result;
                            }
                        },
                        blue:{
                            get: function () {
                                return Math.round(this.passedPercent*bSteps)+curRgb[2];
                            }
                        },
                    });
                } else {
                    var bCurrent = curRgb[2];
                    var bStep = bSteps/bStepsAbs;
                    Object.defineProperties(this, {
                        passedPercent:{
                            get: function () {
                                return (bCurrent-curRgb[2])/bSteps;
                            }
                        },
                        red:{
                            get: function () {
                                return Math.round(this.passedPercent*rSteps)+curRgb[0];
                            }
                        },
                        green:{
                            get: function () {
                                return Math.round(this.passedPercent*gSteps)+curRgb[1];
                            }
                        },
                        blue:{
                            get: function () {
                                var result = bCurrent;
                                bCurrent+=bStep;
                                return result;
                            }
                        },
                    });
                }
            }

            var num = 0;

            function getNextColorSet() {
                var nextNum = num+1;
                if (nextNum<colors.length){
                    return new SmoothColorTransition(colors[num++], colors[nextNum]);
                } else
                    return false;
            }
            var colorSet = getNextColorSet();
            return function () {
                if (colorSet){
                    if (colorSet.passedPercent>=1){
                        colorSet = getNextColorSet();
                    }
                    return {
                        red: colorSet.red,
                        green: colorSet.green,
                        blue: colorSet.blue
                    };
                } else {
                    return false;
                }
            };
        }();



        function getAnotherColor(imgData) {
            var currentColor = Colors();
            var arr = imgData.data;
            return new Promise(function (resolve, reject) {
                if (currentColor) {
                    for (i = 0; i < arr.length; i += 4) {
                        if (arr[i] || arr[i + 1] || arr[i + 2]) {
                            arr[i] = currentColor.red;
                            arr[i + 1] = currentColor.green;
                            arr[i + 2] = currentColor.blue;
                        }

                        if ((i + 4) === arr.length) {
                            resolve(imgData);
                            return imgData;
                        }
                    }
                } else {
                    console.log('timePass = '+(Date.now()-startTime)+'ms');
                    reject();
                }

            });

        }


        function getImageData(img) {
            var testCtx = createTestCtx(img.naturalWidth, img.naturalHeight);
            testCtx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);
            return testCtx.getImageData(0, 0, img.naturalHeight, img.naturalHeight);

            function createTestCtx(w, h) {
                var testCanvas = document.createElement('canvas');
                testCanvas.width=w;
                testCanvas.height=h;
                testCanvas.style.display = 'none';
                return testCanvas.getContext('2d');
            }
        } */

    </script>
</body>
</html>